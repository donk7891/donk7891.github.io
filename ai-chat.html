<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>讯飞星火AI聊天</title>
    <style>/* 样式和之前一致，省略 */</style>
</head>
<body>
    <!-- 页面结构和之前一致，省略 -->
    <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.2.0/crypto-js.min.js"></script>
    <script>
        // 密钥配置
        const APPID = "c447f027";
        const APIKey = "9430d8fde0e371b4b1315e44be61bfeb";
        const APISecret = "OGM2NGU0N2FkYWZkMjYyMDFhNGJjOThi";
        
        // 生成Authorization签名
        function getAuthorization(date) {
            const signatureOrigin = `host: spark-api.xf-yun.com\ndate: ${date}\nPOST /v3.5/chat HTTP/1.1`;
            const signatureSha = CryptoJS.HmacSHA256(signatureOrigin, APISecret);
            const signature = CryptoJS.enc.Base64.stringify(signatureSha);
            const authorizationOrigin = `api_key="${APIKey}", algorithm="hmac-sha256", headers="host date request-line", signature="${signature}"`;
            return CryptoJS.enc.Base64.stringify(CryptoJS.enc.Utf8.parse(authorizationOrigin));
        }

        // 发送消息
        async function sendMessageToXinghuo(message) {
            addMessage(message, true);
            // ... 加载提示逻辑和之前一致 ...

            const date = new Date().toUTCString();
            const authorization = getAuthorization(date);
            
            try {
                const response = await fetch("https://spark-api.xf-yun.com/v3.5/chat", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Host": "spark-api.xf-yun.com",
                        "Date": date,
                        "Authorization": authorization
                    },
                    body: JSON.stringify({
                        "header": { "app_id": APPID },
                        "parameter": {
                            "chat": { "domain": "generalv3.5", "temperature": 0.5, "max_tokens": 2048 }
                        },
                        "payload": {
                            "message": { "text": [{ "role": "user", "content": message }] }
                        }
                    })
                });

                const result = await response.json();
                if (result.header.code === 0) {
                    const aiReply = result.payload.choices.text[0].content;
                    addMessage(aiReply, false);
                } else {
                    throw new Error(`讯飞API错误：${result.header.message}`);
                }
            } catch (error) {
                // ... 错误处理逻辑和之前一致 ...
            }
        }

        // 绑定事件+欢迎语（和之前一致）
        // ... 省略重复代码 ...
    </script>
</body>
</html>
